From 32bafbc0723a67ed9af56e18aa95724f4c4d266b Mon Sep 17 00:00:00 2001
From: Pierrick Bouvier <pierrick.bouvier@linaro.org>
Date: Mon, 23 Feb 2026 10:03:23 -0800
Subject: [PATCH] TMP: fix(qemu): Support lower PMU versions

Although RME mandates v3p7, QEMU has v3p5 at the moment. Until we
implement the p7 extension, which provides counter isolation for EL3,
allow p5.

From: Jean-Philippe Brucker <jean-philippe@linaro.org>
Signed-off-by: Jean-Philippe Brucker <jean-philippe@linaro.org>
Change-Id: Id1dd30486f203187e3f882c7495116b743d3883a
---
 lib/arch/include/arch.h | 1 +
 runtime/rmi/feature.c   | 2 +-
 2 files changed, 2 insertions(+), 1 deletion(-)

diff --git a/lib/arch/include/arch.h b/lib/arch/include/arch.h
index 4ee0e9b..d60dab9 100644
--- a/lib/arch/include/arch.h
+++ b/lib/arch/include/arch.h
@@ -546,6 +546,7 @@
 #define ID_AA64DFR0_EL1_PMUVer_WIDTH		UL(4)
 
 /* Performance Monitors Extension version */
+#define ID_AA64DFR0_EL1_PMUv3p5			UL(5)
 #define ID_AA64DFR0_EL1_PMUv3p7			UL(7)
 #define ID_AA64DFR0_EL1_PMUv3p8			UL(8)
 #define ID_AA64DFR0_EL1_PMUv3p9			UL(9)
diff --git a/runtime/rmi/feature.c b/runtime/rmi/feature.c
index 86e6dbb..3b71c9a 100644
--- a/runtime/rmi/feature.c
+++ b/runtime/rmi/feature.c
@@ -70,7 +70,7 @@ unsigned long get_feature_register_0(void)
 		     INPLACE(RMI_FEATURE_REGISTER_0_HASH_SHA_512, RMI_FEATURE_TRUE);
 
 	/* RMM supports PMUv3p7+ */
-	assert(read_pmu_version() >= ID_AA64DFR0_EL1_PMUv3p7);
+	assert(read_pmu_version() >= ID_AA64DFR0_EL1_PMUv3p5);
 
 	/* Set support for PMUv3 */
 	feat_reg0 |= INPLACE(RMI_FEATURE_REGISTER_0_PMU_EN,
-- 
2.47.3

